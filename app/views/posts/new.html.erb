<% provide(:title, "投稿画面") %>
<h1>投稿しよう</h1>
<div class="row">
  <div class="col-md-6 col-md-offset-3">
    <%= form_for(@post) do |f| %>
    <%= render  "shared/error_messages", object: f.object %>
      <div class="field">
        <%= f.text_field :title,  placeholder: "タイトル" %>
      </div>
      <%= f.label :picture, "投稿する写真を選択してください" %>
      <%= f.file_field :picture, accept: 'image/jpeg,picture/gif,picture/png',
                            id: "post_picture", class: "picture_form" %>
      <% if @post.picture.present? %>
        <%= image_tag @post.picture, id: :img_prev %>
      <% else %>
        <%= image_tag "/noimage.svg", id: :img_prev %>
      <% end %>
  
      <script type="text/javascript">
        $(function() {
          function readURL(input) {
              if (input.files && input.files[0]) {
              var reader = new FileReader();
              reader.onload = function (e) {
          $('#img_prev').attr('src', e.target.result);
              }
              reader.readAsDataURL(input.files[0]);
              }
          }
          $("#post_picture").change(function(){
              readURL(this);
          });
        });
      </script>
      
      <%= f.submit "投稿", class: "btn btn-primary" %>
    <% end %>
  
    <script type="text/javascript">
      $('#post_picture').bind('change', function() {
        var size_in_megabytes = this.files[0].size/1024/1024;
        if (size_in_megabytes > 5) {
          alert('添付ファイルのサイズ上限は5MBまでです');
        }
      });
    </script>
  </div>
</div> 